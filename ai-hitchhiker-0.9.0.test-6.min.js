let model,maxPredictions;async function ai_init(){console.clear(),console.log("! 인공지능을 연결합니다.");let t=모델주소+"model.json",e=모델주소+"metadata.json";maxPredictions=(model=await tmPose.load(t,e)).getTotalClasses(),net=await posenet.load(),console.log("! 인공지능 모델을 불러왔습니다."),window.requestAnimationFrame(anim)}async function anim(t){await predict(),await getPoses(),window.requestAnimationFrame(anim)}async function predict(){if(video&&video.elt&&video.loadedmetadata){let{pose:t,posenetOutput:e}=await model.estimatePose(video.elt),o=await model.predict(e),s;for(let n of o)s?n.probability>s.probability&&(s=n):s=n;AI분류=s.className}}const scaleFactor=.5,flipHorizontal=!1,outputStride=16;let net,관절=[];for(let i=0;i<17;i++)관절[i]={x:0,y:0};async function getPoses(){if(video&&video.elt&&video.loadedmetadata&&net)for(let t of(_poses=기본설정.멀티포즈?await net.estimateMultiplePoses(video.elt,.5,!1,16):[await net.estimateSinglePose(video.elt,.5,!1,16)],poses=[],_poses.length>0&&(관절=_poses[0].keypoints),_poses))poses.push({pose:t})}function drawPoints(t){for(let e=0;e<t.length;e+=1)push(),translate(t[e].position.x,t[e].position.y),fill(255),ellipse(0,0,8,8),textAlign(CENTER,BOTTOM),textSize(15),text(e,0,-5),pop()}function getAllPoints(t){let e=[];if(t)for(let o=0;o<t.keypoints.length;o+=1){let s=t.keypoints[o];s.score>.2&&e.push({position:new p5.Vector(s.position.x,s.position.y)})}return e}function drawKeypoints(){for(let t=0;t<poses.length;t+=1){let e=poses[t].pose;if(e)for(let o=0;o<e.keypoints.length;o+=1){let s=e.keypoints[o];s.score>.2&&ellipse(s.position.x,s.position.y,10,10)}}}posenet.load().then(function(t){console.log("posenet loaded")});var bgSat=!0,strokeSat=!1,fillSat=!0,Settings=function(){this.관절표시=!0,this.격자=!1,this.좌우반전=!1,this.배경색="#000000",this.배경색_투명도=0,this.정보출력=!0,this.멀티포즈=!0},기본설정=new Settings,gui=new dat.GUI;let f1=gui.addFolder("기본설정");f1.add(기본설정,"관절표시").listen(),f1.add(기본설정,"격자").listen(),f1.add(기본설정,"좌우반전").listen(),f1.addColor(기본설정,"배경색").listen(),f1.add(기본설정,"배경색_투명도",0,255).step(1).listen(),f1.add(기본설정,"정보출력").listen(),f1.add(기본설정,"멀티포즈").listen();var ParticleSetting=function(){this.활성화=!1,this.생성부위="전체",this.지속시간=1,this.중력=0,this.생성위치흐트림=1,this.난기류=.2,this.빈도=1},입자설정=new ParticleSetting;let f6=gui.addFolder("입자설정");f6.add(입자설정,"지속시간",1,60).step(.1).listen(),f6.add(입자설정,"중력",-1,1).step(.01).listen(),f6.add(입자설정,"생성위치흐트림",0,1).step(.01).listen(),f6.add(입자설정,"난기류",0,1).step(.01).listen(),f6.add(입자설정,"빈도",1,60).step(1).listen();var particles=[],TrajectorySetting=function(){this.빈도=1,this.길이=100,this.궤적초기화=궤적초기화},궤적설정=new TrajectorySetting;let f7=gui.addFolder("궤적설정");f7.add(궤적설정,"빈도",1,60).step(1).listen(),f7.add(궤적설정,"길이",1,500).step(1).listen(),f7.add(궤적설정,"궤적초기화");const 이미지리스트=["고양이","똥","번개","토마토","하트"];let trajectory=[];function 궤적초기화(){trajectory=[];for(let t=0;t<17;t++)trajectory.push([])}function 디자인(){}function 궤적디자인(){}function 궤적(t=궤적디자인,e=0){if(poses&&poses.length>0){let o=poses[0];if(o.pose){frameCount%궤적설정.빈도==0&&trajectory[e].push({design:t||궤적디자인,pos:o.pose.keypoints[e].position});let s=궤적설정.길이;trajectory[e].length>s&&trajectory[e].splice(0,trajectory[e].length-s)}}}function 그리기(t=디자인,e=0){if(poses&&poses.length>0){for(let o of poses)if(o.pose){let s=o.pose.keypoints.map(t=>t.position);t?t(s,s[e],new p5.Vector):디자인(s,s[e],new p5.Vector)}}}function drawTrajectory(){for(let t of trajectory)if(t.length>1)for(let e=0;e<t.length-1;e++){let o={x:t[e].pos.x-t[t.length-1].pos.x,y:t[e].pos.y-t[t.length-1].pos.y},s=new p5.Vector(t[e].pos.x,t[e].pos.y),n=new p5.Vector(t[e+1].pos.x,t[e+1].pos.y),a=[];for(let r=0;r<17;r++)a.push(new p5.Vector);poses.length>0&&poses[0].pose&&(a=[],a=poses[0].pose.keypoints.map(t=>({x:t.position.x+o.x,y:t.position.y+o.y}))),s||(s=new p5.Vector),n||(n=new p5.Vector),push(),t[e].design(a,s,n),pop()}}function drawGrid(t=10){strokeWeight(1);for(let e=0;e<=width;e+=t)e%100==0?stroke(255):stroke(255,100),line(e,0,e,height);for(let o=0;o<=height;o+=t)o%100==0?stroke(255):stroke(255,100),line(0,o,width,o)}function 입자(t=디자인,e=0){if(poses&&poses.length>0){for(let o of poses)if(o.pose){let s=o.pose.keypoints[e].position;frameCount%입자설정.빈도==0&&particles.push(new Particle(e,s,t||디자인))}}}궤적초기화();class Particle{constructor(t,e,o){let s=e.x,n=e.y;var a=10*입자설정.생성위치흐트림;this.pos=new p5.Vector(s+random(-a,a),n+random(-a,a)),this.prevPosArray=[],this.vel=new p5.Vector,this.acc=new p5.Vector,this.지속시간=10+5*입자설정.지속시간,this.dying_speed=1,this.design=o,this.index=t}applyForce(t){this.acc.add(t)}update(){if(this.지속시간-=this.dying_speed,this.applyForce(new p5.Vector(0,입자설정.중력)),입자설정.난기류>0){var t=new p5.Vector(입자설정.난기류/2,0);t.rotate(noise(.01*this.pos.x+.01*frameCount,.01*this.pos.y)*TWO_PI*2),this.applyForce(t)}this.vel.add(this.acc),this.prevPosArray.push(this.pos.copy()),this.pos.add(this.vel),this.acc.mult(0),(this.pos.x<0||this.pos.x>width||this.pos.y<0||this.pos.y>height)&&(this.지속시간=0)}display(){if(push(),poses&&poses.length>0){for(let t of poses)if(t.pose){let e=this.pos,o=t.pose.keypoints[this.index].position,s=t.pose.keypoints.map(t=>new p5.Vector(t.position.x+(e.x-o.x),t.position.y+(e.y-o.y)));e&&(!e||e.x)||(e=new p5.Vector),this.design(s,e,new p5.Vector)}}else this.design(Array.from({length:17},()=>new p5.Vector),this.pos?this.pos:new p5.Vector,new p5.Vector);pop()}run(){this.update(),this.display()}}function deepClone(t){if(null===t||"object"!=typeof t)return t;let e=Array.isArray(t)?[]:{};for(let o of Object.keys(t))e[o]=deepClone(t[o]);return e}function hexCon(t){let e=t.toString(16);return e.length>1?e:"0"+e}function HSVtoRGB(t,e,o){var s,n,a,r,l,p,d,$;switch(1===arguments.length&&(e=t.s,o=t.v,t=t.h),r=Math.floor(6*t),l=6*t-r,p=o*(1-e),d=o*(1-l*e),$=o*(1-(1-l)*e),r%6){case 0:s=o,n=$,a=p;break;case 1:s=d,n=o,a=p;break;case 2:s=p,n=o,a=$;break;case 3:s=p,n=d,a=o;break;case 4:s=$,n=p,a=o;break;case 5:s=o,n=p,a=d}return{r:Math.round(255*s),g:Math.round(255*n),b:Math.round(255*a)}}let video,poseNet,poses=[],씬번호=1,AI분류="";function 초기설정(t=!1){t?(resizeCanvas(480,480),video=createCapture({video:{mandatory:{minWidth:240,minHeight:240,maxWidth:240,maxHeight:240}},audio:!1},function(){ai_init()})):video=createCapture(VIDEO,function(){ai_init()}),video.size(width,height),video.hide(),textAlign(CENTER)}function 시작(){clear(),기본설정.좌우반전&&(translate(width,0),scale(-1,1)),imageMode(CORNER),image(video,0,0,width,height),imageMode(CENTER),noStroke(),rectMode(CENTER),fill(기본설정.배경색+hexCon(기본설정.배경색_투명도)),rect(width/2,height/2,width,height),기본설정.격자&&drawGrid()}function 끝(){for(var t of particles)t.run();if(particles=particles.filter(t=>t.지속시간>0),drawTrajectory(),기본설정.관절표시)for(let e=0;e<poses.length;e+=1){let o=getAllPoints(poses[e].pose);stroke(255),fill(255),drawPoints(o)}기본설정.정보출력&&(fill(255),noStroke(),textAlign(LEFT,BOTTOM),textSize(30),text(AI분류,0,height),textAlign(RIGHT,BOTTOM),textSize(30),text(씬번호,width-15,height))}function 씬번호바꾸기(){keyCode===LEFT_ARROW&&씬번호>1?씬번호--:keyCode===RIGHT_ARROW&&씬번호<9&&씬번호++;var t=int(key);t>0&&t<10&&(씬번호=t)}