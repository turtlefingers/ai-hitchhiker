let model,maxPredictions;async function ai_init(){console.clear(),console.log("! 인공지능을 연결합니다.");let t=모델주소+"model.json",e=모델주소+"metadata.json";maxPredictions=(model=await tmPose.load(t,e)).getTotalClasses(),net=await posenet.load(),console.log("! 인공지능 모델을 불러왔습니다."),window.requestAnimationFrame(anim)}async function anim(t){await predict(),await getPoses(),window.requestAnimationFrame(anim)}async function predict(){if(video.loadedmetadata){let{pose:t,posenetOutput:e}=await model.estimatePose(video.elt),s=await model.predict(e),o;for(let n of s)o?n.probability>o.probability&&(o=n):o=n;AI분류=o.className}}const scaleFactor=.5,flipHorizontal=!1,outputStride=16;let net,관절=[];for(let i=0;i<17;i++)관절[i]={x:0,y:0};async function getPoses(){if(net)for(let t of(_poses=await net.estimateMultiplePoses(video.elt,.5,!1,16),poses=[],_poses.length>0&&(관절=_poses[0].keypoints),_poses))poses.push({pose:t})}function drawPoints(t){for(let e=0;e<t.length;e+=1)push(),translate(t[e].position.x,t[e].position.y),fill(255),ellipse(0,0,8,8),textAlign(CENTER,BOTTOM),textSize(15),text(e,0,-5),pop()}function getAllPoints(){let t=[];for(let e=0;e<poses.length;e+=1){let s=poses[e].pose;if(s)for(let o=0;o<s.keypoints.length;o+=1){let n=s.keypoints[o];n.score>.2&&t.push({position:new p5.Vector(n.position.x,n.position.y)})}}return t}function drawKeypoints(){for(let t=0;t<poses.length;t+=1){let e=poses[t].pose;if(e)for(let s=0;s<e.keypoints.length;s+=1){let o=e.keypoints[s];o.score>.2&&ellipse(o.position.x,o.position.y,10,10)}}}posenet.load().then(function(t){console.log("posenet loaded")});var bgSat=!0,strokeSat=!1,fillSat=!0,Settings=function(){this.관절표시=!0,this.격자=!1,this.좌우반전=!1,this.배경색="#000000",this.배경색_투명도=0,this.정보출력=!0},기본설정=new Settings,gui=new dat.GUI;let f1=gui.addFolder("기본설정");f1.add(기본설정,"관절표시").listen(),f1.add(기본설정,"격자").listen(),f1.add(기본설정,"좌우반전").listen(),f1.addColor(기본설정,"배경색").listen(),f1.add(기본설정,"배경색_투명도",0,255).step(1).listen(),f1.add(기본설정,"정보출력").listen();var ParticleSetting=function(){this.활성화=!1,this.생성부위="전체",this.지속시간=1,this.중력=0,this.생성위치흐트림=1,this.난기류=.2,this.빈도=1},파티클=new ParticleSetting;let f6=gui.addFolder("파티클");f6.add(파티클,"지속시간",1,60).step(.1).listen(),f6.add(파티클,"중력",-1,1).step(.01).listen(),f6.add(파티클,"생성위치흐트림",0,1).step(.01).listen(),f6.add(파티클,"난기류",0,1).step(.01).listen(),f6.add(파티클,"빈도",1,60).step(1).listen();var particles=[],TrajectorySetting=function(){this.빈도=1,this.길이=100,this.궤적초기화=궤적초기화},궤적설정=new TrajectorySetting;let f7=gui.addFolder("궤적설정");f7.add(궤적설정,"빈도",1,60).step(1).listen(),f7.add(궤적설정,"길이",1,500).step(1).listen(),f7.add(궤적설정,"궤적초기화");const 이미지리스트=["고양이","똥","번개","토마토","하트"];let trajectory=[];function 궤적초기화(){trajectory=[];for(let t=0;t<17;t++)trajectory.push([])}function 디자인(){}function 궤적디자인(){}function 궤적(t=궤적디자인,e=0){if(poses&&poses.length>0){let s=poses[0];if(s.pose){frameCount%궤적설정.빈도==0&&trajectory[e].push({design:t||궤적디자인,pos:s.pose.keypoints[e].position});let o=궤적설정.길이;trajectory[e].length>o&&trajectory[e].splice(0,trajectory[e].length-o)}}}function 그리기(t=디자인,e=0){if(poses&&poses.length>0){for(let s of poses)if(s.pose){let o=s.pose.keypoints.map(t=>t.position);t?t(o,o[e],new p5.Vector):디자인(o,o[e],new p5.Vector)}}}function drawTrajectory(){for(let t of trajectory)if(t.length>1)for(let e=0;e<t.length-1;e++){let s={x:t[e].pos.x-t[t.length-1].pos.x,y:t[e].pos.y-t[t.length-1].pos.y},o=new p5.Vector(t[e].pos.x,t[e].pos.y),n=new p5.Vector(t[e+1].pos.x,t[e+1].pos.y);t.length,p5.Vector.sub(n,o);let r=[];for(let a=0;a<17;a++)r.push(new p5.Vector);poses.length>0&&poses[0].pose&&(r=[],r=poses[0].pose.keypoints.map(t=>({x:t.position.x+s.x,y:t.position.y+s.y}))),push(),t[e].design(r,o,n),pop()}}function drawGrid(t=10){strokeWeight(1);for(let e=0;e<=width;e+=t)e%100==0?stroke(255):stroke(255,100),line(e,0,e,height);for(let s=0;s<=height;s+=t)s%100==0?stroke(255):stroke(255,100),line(0,s,width,s)}function 입자(t=디자인,e=0){if(poses&&poses.length>0){for(let s of poses)if(s.pose){let o=s.pose.keypoints[e].position;frameCount%파티클.빈도==0&&particles.push(new Particle(e,o,t||디자인))}}}궤적초기화();class Particle{constructor(t,e,s){let o=e.x,n=e.y;var r=10*파티클.생성위치흐트림;this.pos=new p5.Vector(o+random(-r,r),n+random(-r,r)),this.prevPosArray=[],this.vel=new p5.Vector,this.acc=new p5.Vector,this.지속시간=10+5*파티클.지속시간,this.dying_speed=1,this.design=s,this.index=t}applyForce(t){this.acc.add(t)}update(){if(this.지속시간-=this.dying_speed,this.applyForce(new p5.Vector(0,파티클.중력)),파티클.난기류>0){var t=new p5.Vector(파티클.난기류/2,0);t.rotate(noise(.01*this.pos.x+.01*frameCount,.01*this.pos.y)*TWO_PI*2),this.applyForce(t)}this.vel.add(this.acc),this.prevPosArray.push(this.pos.copy()),this.pos.add(this.vel),this.acc.mult(0),(this.pos.x<0||this.pos.x>width||this.pos.y<0||this.pos.y>height)&&(this.지속시간=0)}display(){if(push(),poses&&poses.length>0){for(let t of poses)if(t.pose){let e=this.pos,s=t.pose.keypoints[this.index].position,o=t.pose.keypoints.map(t=>new p5.Vector(t.position.x+(e.x-s.x),t.position.y+(e.y-s.y)));this.design(o,e,new p5.Vector)}}else this.design();pop()}run(){this.update(),this.display()}}function deepClone(t){if(null===t||"object"!=typeof t)return t;let e=Array.isArray(t)?[]:{};for(let s of Object.keys(t))e[s]=deepClone(t[s]);return e}function hexCon(t){let e=t.toString(16);return e.length>1?e:"0"+e}function HSVtoRGB(t,e,s){var o,n,r,a,l,p,$,c;switch(1===arguments.length&&(e=t.s,s=t.v,t=t.h),a=Math.floor(6*t),l=6*t-a,p=s*(1-e),$=s*(1-l*e),c=s*(1-(1-l)*e),a%6){case 0:o=s,n=c,r=p;break;case 1:o=$,n=s,r=p;break;case 2:o=p,n=s,r=c;break;case 3:o=p,n=$,r=s;break;case 4:o=c,n=p,r=s;break;case 5:o=s,n=p,r=$}return{r:Math.round(255*o),g:Math.round(255*n),b:Math.round(255*r)}}let video,poseNet,poses=[],씬번호=1,AI분류="";function 초기설정(){(video=createCapture(VIDEO)).size(width,height),video.hide(),textAlign(CENTER),ai_init()}function 시작(){clear(),기본설정.좌우반전&&(translate(width,0),scale(-1,1)),imageMode(CORNER),image(video,0,0,width,height),imageMode(CENTER),noStroke(),rectMode(CENTER),fill(기본설정.배경색+hexCon(기본설정.배경색_투명도)),rect(width/2,height/2,width,height),기본설정.격자&&drawGrid()}function 끝(){for(var t of particles)t.run();if(particles=particles.filter(t=>t.지속시간>0),drawTrajectory(),기본설정.관절표시){let e=getAllPoints();stroke(255),fill(255),drawPoints(e)}기본설정.정보출력&&(fill(255),noStroke(),textAlign(LEFT,BOTTOM),textSize(30),text(AI분류,0,height),textAlign(RIGHT,BOTTOM),textSize(30),text(씬번호,width-15,height))}function 씬번호바꾸기(){keyCode===LEFT_ARROW&&씬번호>1?씬번호--:keyCode===RIGHT_ARROW&&씬번호<9&&씬번호++;var t=int(key);t>0&&t<10&&(씬번호=t)}